<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AME: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AME
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__c_m_s_i_s_5__c_m_s_i_s__d_s_p__python_wrapper__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This Python wrapper for CMSIS-DSP is compatible with numpy.</p>
<p>It is a very experimental wrapper with lots of limitations as described in the corresponding section below.</p>
<p>But even with those limitations, it can be very useful to test a CMSIS-DSP implemention of an algorithm with all the power of numpy and scipy.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
How to build and install</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Tested configurations</h2>
<p>The building of this package has been tested on Windows with the Python install from python.org and Microsoft Visual 2017.</p>
<p>It has also been tested with cygwin. In that case, python-devel must be installed too. To run the examples, scipy and matplotlib must also be installed in cygwin.</p>
<p>On Linux, it worked with standard installation.</p>
<p>Other configurations should work but the setup.py file would have to be improved. It is a first version and the build process will have to be improved.</p>
<p>The package is working with Python 2 and 3.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Building</h2>
<p>Since the CMSIS-DSP wrapper is using numpy, you must first install it if not already done. So, for instance to install it locally you could do: </p><pre class="fragment">&gt; pip install numpy --user
</pre><p> Once numpy is installed, you can build the CMSIS-DSP python wrapper. Go to folder CMSIS/DSP/PythonWrapper.</p>
<p>Following command will build in place if you have the right compiler and if Python can find it. </p><pre class="fragment">&gt; python setup.py build_ext --inplace
</pre><p> Then, if you launch Python from same directory you'll be able to play with the test scripts. You'll need to install a few additional Python packages to run the examples (scipy and matplotlib). See below.</p>
<p>If you want to install the cmsisdsp package, it is advised to install it into a virtualenv</p>
<p>With Python 3 you could:</p>
<p>Create a folder for this virtual environment. For instance : cmsisdsp_tests</p>
<p>Go to this folder.</p>
<p>Type: </p><pre class="fragment">&gt; python -m venv env
</pre><p> Activate the environment: </p><pre class="fragment">&gt; env\Scripts\activate
</pre><p> Install some packages to be able to run the examples </p><pre class="fragment">&gt; pip install numpy
&gt; pip install scipy
&gt; pip install matplotlib
</pre><p> Now, you can install the cmsisdsp package in editable mode: </p><pre class="fragment">&gt; pip install -e "Path To The Folder Containing setup.py"
</pre><p> Then you can copy the scripts testdsp.py and example.py and try to run them from this virtual environment. example.y is requiring a data file to be downloaded from the web. See below in this document for the link.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Usage</h1>
<p>You can look at testdsp.py and example.py for some examples.</p>
<p>The idea is to follow as closely as possible the CMSIS-DSP API to ease the migration to the final implementation on a board.</p>
<p>First you need to import the module </p><pre class="fragment">&gt; import cmsisdsp as dsp
</pre><p> If you use numpy: </p><pre class="fragment">&gt; import numpy as np
</pre><p> If you use scipy signal processing functions: </p><pre class="fragment">&gt; from scipy import signal
</pre> <h2><a class="anchor" id="autotoc_md9"></a>
Functions with no instance arguments</h2>
<p>You can use a CMSIS-DSP function with numpy arrays: </p><pre class="fragment">&gt; r = dsp.arm_add_f32(np.array([1.,2,3]),np.array([4.,5,7]))
</pre><p> The function can also be called more simply with </p><pre class="fragment">&gt; r = dsp.arm_add_f32([1.,2,3],[4.,5,7])
</pre><p> The result of a CMSIS-DSP function will always be a numpy array whatever the arguments were (numpy array or list).</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Functions with instance arguments</h2>
<p>When the CMSIS-DSP function is requiring an instance data structure, it is just a bit more complex to use it:</p>
<p>First you need to create this instance: </p><pre class="fragment">&gt; firf32 = dsp.arm_fir_instance_f32()
</pre><p> Although the initialization function on Python side can also be used to initialize some of the fields of the corresponding instance using named arguments, it is not advised to do so. In CMSIS-DSP there are initialization functions for this and they may do some additional processing.</p>
<p>So, you need to call an init function: </p><pre class="fragment">&gt; dsp.arm_fir_init_f32(firf32,3,[1.,2,3],[0,0,0,0,0,0,0])
</pre><p> The third argument in this function is the state. Since all arguments (except the instance ones) are read-only in this Python API, this state will never be changed ! It is just used to communicate the length of the state array which must be allocated by the init function. This argument is required because it is present in the CMSIS-DSP API and in the final C implementation you'll need to allocate a state array with the right dimension.</p>
<p>Since the goal is to be as close as possible to the C API, the API is forcing the use of this argument.</p>
<p>The only change compared to the C API is that the size variables (like blockSize for filter) are computed automatically from the other arguments. This choice was made to make it a bit easier the use of numpy array with the API.</p>
<p>Now, you can check that the instance was initialized correctly. </p><pre class="fragment">&gt; print(firf32.numTaps())
</pre><p> Then, you can filter with CMSIS-DSP.: </p><pre class="fragment">&gt; print(dsp.arm_fir_f32(firf32,[1,2,3,4,5]))
</pre><p> The size of this signal should be blockSize. blockSize was inferred from the size of the state array : numTaps + blockSize - 1 according to CMSIS-DSP. So here the signal must have 5 samples.</p>
<p>If you want to filter more than 5 samples, then you can just call the function again. The state variable inside firf32 will ensure that it works like in the CMSIS-DSP C code. </p><pre class="fragment">&gt; print(dsp.arm_fir_f32(firf32,[6,7,8,9,10]))
</pre><p> If you want to compare with scipy it is easy but warning : coefficients for the filter are in opposite order in scipy : </p><pre class="fragment">&gt; filtered_x = signal.lfilter([3,2,1.], 1.0, [1,2,3,4,5,6,7,8,9,10])
&gt; print(filtered_x)
</pre><p> The principles are the same for all other APIs.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
FFT</h2>
<p>For Fourier transforms there are no init functions in the CMSIS-DSP for the instance variables. They must be initialized from a C struct. To make it simpler to use them from Python, the wrapper is introducing its own init functions.</p>
<p>Here is an example for using FFT from the Python interface:</p>
<p>Let's define a signal you will use for the FFT. </p><pre class="fragment">&gt; nb = 16
&gt; signal = np.cos(2 * np.pi * np.arange(nb) / nb)
</pre><p> The CMSIS-DSP cfft is requiring complex signals with a specific layout in memory.</p>
<p>To remain as close as possible to the C API, we are not using complex numbers in the wrapper. So a complex signal must be converted into a real one. The function imToReal1D is defined in testdsp.py </p><pre class="fragment">&gt; signalR = imToReal1D(signal)
</pre><p> Then, you create the FFT instance with: </p><pre class="fragment">&gt; cfftf32=dsp.arm_cfft_instance_f32()
</pre><p> You initialize the instance with the init function provided by the wrapper: </p><pre class="fragment">&gt; status=dsp.arm_cfft_init_f32(cfftf32, nb)
&gt; print(status)
</pre><p> You compute the FFT of the signal with: </p><pre class="fragment">&gt; resultR = dsp.arm_cfft_f32(cfftf32,signalR,0,1)
</pre><p> You convert back to a complex format to compare with scipy: </p><pre class="fragment">&gt; resultI = realToIm1D(resultR)
&gt; print(resultI)
</pre> <h2><a class="anchor" id="autotoc_md12"></a>
Matrix</h2>
<p>For matrix, the instance variables are masked by the Python API. We decided that for matrix only there was no use for having the CMSIS-DSP instance visibles since they contain the same information as the numpy array (samples and dimension).</p>
<p>So to use a CMSIS-DSP matrix function, it is very simple: </p><pre class="fragment">&gt; a=np.array([[1.,2,3,4],[5,6,7,8],[9,10,11,12]])
&gt; b=np.array([[1.,2,3],[5.1,6,7],[9.1,10,11],[5,8,4]])
</pre><p> Numpy result as reference: </p><pre class="fragment">&gt; print(np.dot(a , b))
</pre><p> CMSIS-DSP result: </p><pre class="fragment">&gt; v=dsp.arm_mat_mult_f32(a,b)
&gt; print(v)
</pre><p> In a real C code, a pointer to a data structure for the result v would have to be passed as argument of the function.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
example.py</h2>
<p>This example depends on a data file which can be downloaded here:</p>
<p><a href="https://www.physionet.org/pn3/ecgiddb/Person_87/rec_2.dat">https://www.physionet.org/pn3/ecgiddb/Person_87/rec_2.dat</a></p>
<p>This signal was created for a master thesis:</p>
<p>Lugovaya T.S. Biometric human identification based on electrocardiogram. [Master's thesis] Faculty of Computing Technologies and Informatics, Electrotechnical University "LETI", Saint-Petersburg, Russian Federation; June 2005.</p>
<p>and it is part of the PhysioNet database</p>
<p>Goldberger AL, Amaral LAN, Glass L, Hausdorff JM, Ivanov PCh, Mark RG, Mietus JE, Moody GB, Peng C-K, Stanley HE. PhysioBank, PhysioToolkit, and PhysioNet: Components of a New Research Resource for Complex Physiologic Signals. Circulation 101(23):e215-e220 [Circulation Electronic Pages; <a href="http://circ.ahajournals.org/cgi/content/full/101/23/e215">http://circ.ahajournals.org/cgi/content/full/101/23/e215</a>]; 2000 (June 13).</p>
<h1><a class="anchor" id="autotoc_md14"></a>
LIMITATIONS</h1>
<p>Due to the high number of functions in the CMSIS-DSP, the first version of the wrapper was generated automatically from a custom script.</p>
<p>Only a subset of the functions has been tested.</p>
<p>It is likely that some problems are present. The API is quite regular in CMSIS-DSP but there are a few exceptions and the generation script is not managing all of them.</p>
<p>So, the API may crash due to unallocated variables or wrong data conversions.</p>
<p>The generated C code is a first version for bootstrapping the process. Now that this C file exists, the improvements will be done on the C code rather than on the generation script. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
